# Code for reproducing figures

### Fig. 2: Whack-a-mole effect in the Texas power grid
Run `fig_2_texas_grid_example` to generate PNG image for the figure in [`../output/fig_2_texas_grid_example/`](../output/fig_2_texas_grid_example/), showing the map that visualizes the results for the Texas power grid (ERCOT). It uses data files in [`../data/texas_grid_example_data/`](../data/texas_grid_example_data/), which were generated using Texas grid data and running the associated cascade simulation code (excluded from this repository to comply with an NDA). The data files contain normalized coordinates of the node locations.

### Fig. 3: Geographic distribution of the whack-a-mole effect for the North American power grid
Run `fig_3_power_grid_whack_a_mole` to generate PNG files of a version of the maps visualizing iterations 1-4 of the frequency-based upgrade. The PNG files will be saved in [`../output/fig_3_power_grid_whack_a_mole/](../output/fig_3_power_grid_whack_a_mole/).

### Fig. 4: Distribution of capacity upgrades
- Run `fig_4_county_maps_compute` to compute the two quantities for each county and save the data structure for each strategy in a file in the folder [`../data/fig_4_county_maps/`](../data/fig_4_county_maps/). Note that the capacity upgrade data file required to execute this function is excluded from this repository to comply with an NDA.
- Run `fig_4_county_maps` to create PNG files of the six maps from the data files in `data/fig_4_county_maps/` and saves them to [`../output/fig_4_county_maps/`](../output/fig_4_county_maps/capacity_upgrades_failure_based.png).
- Run `fig_4_print_county_map_stats` to calculate statistics related to the maps.

### Extended Data Fig. 5: Example of the whack-a-mole effect in the Texas power grid in Fig. 2
Run `ext_data_fig_5_texas_grid_example_details`. It produces parts of the figure in [`../output/ext_data_fig_5_texas_grid_example/`](../output/ext_data_fig_5_texas_grid_example/) using data files in [`../data/texas_grid_example_data/`](../data/texas_grid_example_data/).

### Extended Data Fig. 7: The frequency-based strategy for upgrading the North American power grid
Run `ext_data_fig_7_frequency_based` to generate the figure panels and a draft of the overal figure in [`../output/ext_data_fig_7_frequency_based`](../output/ext_data_fig_7_frequency_based/). It uses the data files in [`../data/ext_data_fig_7_frequency_based/`](../data/ext_data_fig_7_frequency_based/), which was generated by the script in that folder from the raw simulation results files (excluded from this repository to comply with an NDA). 

### Extended Data Fig. 8: Robustness of the upgraded system under fluctuating operating conditions
Run `ext_data_fig_8_robustness` to generate the PNG image of the figure in the folder [`../output/ext_data_fig_8_robustness/`](../output/ext_data_fig_8_robustness/) using the simulation resulst data in [`../data/ext_data_fig_8_robustness/`](../data/ext_data_fig_8_robustness/).

### Extended Data Fig. 9: Simulating failure-based upgrades in the North American power grid
Run `ext_data_fig_9_sim_fail_based` to generate the PNG images on which the figure is based and save the in the folder [`../output/ext_data_fig_9_sim_fail_based/`](../output/ext_data_fig_9_sim_fail_based/). It uses the data files in the folder [`../data/failure_based/`](../data/failure_based/). Some of the data files there are generated by running the scripts provided in the subfolder [`data_processing`](../data/failure_based/data_processing/).

### Extended Data Fig. 10: Estimating the cost of overload-based upgrades for the North Ameri- can power grid
The following two functions perform the analysis of the overload strategy results (contained in the folder [`../data/overload_based/`](../data/overload_based/)) for the three interconnections and generate outputs in the folder [`../output/ext_data_fig_10_overload_based/`](../output/ext_data_fig_10_overload_based/):
- Run `ext_data_fig_10_overload_based_compute(poolobj)` to perform resampling of the base simulation results saved in the folder [`../data/overload_based/`](../data/overload_based/), fitting, and extrapolation. It requires `poolobj = parpool(num_workers)` as the input argument, where `num_workers` is the number of parallel workers. The calculation time was ~33 minutes with 16 parallel workers on a multi-core linux machine.
- Run `ext_data_fig_10_overload_based` to create raw plots for the figure in [`../output/ext_data_fig_10_overload_based/`](../output/ext_data_fig_10_overload_based/) using the results saved by `ext_data_fig_10_overload_based_compute`.

## Code for data processing

`create_cap_upg_data` is the function that was used to load all the simulation data and prepare the data structure needed to generate figures and save the data structure. However, the required input data for this function, as well as the output file `../output/cap_upg_data.mat`, are excluded from this repository to comply with an NDA.
